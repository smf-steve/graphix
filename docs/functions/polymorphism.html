<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Polymorphism - The Graphix Programming Language</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Graphix Programming Language</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="polymorphism"><a class="header" href="#polymorphism">Polymorphism</a></h1>
<p>While the compiler does a pretty good job of inferring the types of
functions, sometimes you want to express a constraint that can't be
inferred. Suppose we wanted to write a function that you can pass any
type of number to, but it has to be the same type for both arguments,
and the return type will be the same as the argument type. We can say
that using type variables and constraints in our annotations.</p>
<pre><code class="language-graphix">〉let f = 'a: Number |x: 'a, y: 'a| -&gt; 'a x + y
〉f
-: fn&lt;'a: unbound: Number, '_2101: unbound: Error&lt;ErrChain&lt;`ArithError(string)&gt;&gt;&gt;('a: unbound, 'a: unbound) -&gt; 'a: unbound throws '_2101: unbound
160
</code></pre>
<p>In type annotations of lambda expressions,</p>
<ul>
<li>The constraints come before the first <code>|</code>, separated by commas if there are
multiple constrained type variables. e.g. <code>'a: Number</code></li>
<li>Each argument may optionally have a <code>: Type</code> after it, and this will set it's
type, e.g. <code>x: 'a</code></li>
<li>After the second <code>|</code> you can optionally include an <code>-&gt; Type</code> which will set
the return type of the function, e.g. <code>-&gt; 'a</code></li>
<li>After the return type, you can optionally specify a throws type, <code>throws Type</code>, which will set the type that is thrown by the function</li>
</ul>
<p>In a fn type, after fn the stuff between the <code>&lt;&gt;</code> are the type
constraints, the syntax in this readout is a colon separated list of,</p>
<ul>
<li>type variable name, for example '_2073</li>
<li>current value, or unbound if there is no current value</li>
<li>constraint type</li>
</ul>
<pre><code>fn&lt;'a: unbound: Number, 
   '_2101: unbound: Error&lt;ErrChain&lt;`ArithError(string)&gt;&gt;&gt;
('a: unbound, 'a: unbound) -&gt; 'a: unbound throws '_2101: unbound
</code></pre>
<p>We can remove the (unbound) current values and it becomes easier to read,</p>
<pre><code>fn&lt;'a: Number,
   '_2101: Error&lt;ErrChain&lt;`ArithError(string)&gt;&gt;&gt;
('a, 'a) -&gt; 'a throws '_2101
</code></pre>
<p>We just have two variables now, <code>'a</code> representing both argument types and the
return type, and <code>'_2101</code> representing the throws type. We can still call this <code>f</code> with any number type,</p>
<pre><code class="language-graphix">〉f(1.212, 2.0)
-: f64
3.2119999999999997
</code></pre>
<p>However notice that we get back the explicit type we passed in,</p>
<pre><code class="language-graphix">〉f(2, 2)
-: i64
4
</code></pre>
<p>In one case <code>f64</code>, in the other <code>i64</code>. We can't pass numbers of different types,</p>
<pre><code class="language-graphix">〉f(1, 1.2)
error: in expr

Caused by:
    0: at: line: 1, column: 6, in: f64:1.2
    1: type mismatch 'a: i64 does not contain f64
</code></pre>
<p>Here the compiler is saying that <code>'a</code> is already initialized as <code>i64</code> and <code>i64</code>
doesn't unify with <code>f64</code>.</p>
<h2 id="higher-order-functions"><a class="header" href="#higher-order-functions">Higher Order Functions</a></h2>
<p>Since functions are first class, they can take other functions as arguments, and
even return functions. These relationships can be often inferred automatically
without issue, but sometimes annotations are required.</p>
<pre><code class="language-graphix">〉 let apply = |x: 'a, f: fn('a) -&gt; 'b throws 'e| -&gt; 'b throws 'e f(x)
〉 apply
-: fn&lt;'e: unbound: _&gt;('a: unbound, fn('a: unbound) -&gt; 'b: unbound throws 'e: unbound) -&gt; 'b: unbound throws 'e: unbound
163
</code></pre>
<p>Here we've specified a single argument apply, it takes an argument, and a
function <code>f</code>, and calls <code>f</code> on the argument. Note that we've explicitly said
that whatever type of error <code>f</code> throws, <code>apply</code> will throw as well. That was
constrained by the compiler to <code>_</code> meaning basically this could throw anything
or also not throw at all, it just depends on <code>f</code>.</p>
<p>We can see a more practical example in the type of <code>array::map</code> (this
implementation of which I will not repeat here), which is,</p>
<pre><code>fn(Array&lt;'a&gt;, fn('a) -&gt; 'b throws 'e) -&gt; Array&lt;'b&gt; throws 'e
</code></pre>
<p>So map takes an array of <code>'a</code>, and a function mapping <code>'a</code> to <code>'b</code> and possibly
throwing <code>'e</code> and returns an array of <code>'b</code> possibly throwing <code>'e</code>.</p>
<h2 id="implicit-polymorphism"><a class="header" href="#implicit-polymorphism">Implicit Polymorphism</a></h2>
<p>All functions are polymorphic, even without annotations, argument and return
types are inferred at each call site, and thus may differ from one site to
another. Any internal constraints are calculated when the definition is compiled
and are enforced at each call site. For example consider,</p>
<pre><code class="language-graphix">〉let f = |x, y| x + y
〉f
-: fn&lt;'_2073: unbound: Error&lt;ErrChain&lt;`ArithError(string)&gt;&gt;, '_2069: unbound: Number, '_2067: unbound: Number, '_2071: unbound: Number&gt;('_2067: unbound, '_2069: unbound) -&gt; '_2071: unbound throws '_2073: unbound
159
</code></pre>
<p>The type is a bit of a mouthfull, lets format it a bit so it's easier to read.</p>
<pre><code>fn&lt;'_2073: unbound: Error&lt;ErrChain&lt;`ArithError(string)&gt;&gt;,
   '_2069: unbound: Number,
   '_2067: unbound: Number,
   '_2071: unbound: Number&gt;
('_2067: unbound, '_2069: unbound) -&gt; '_2071: unbound throws '_2073: unbound
</code></pre>
<p>Removing the unbounds,</p>
<pre><code>fn&lt;'_2073: Error&lt;ErrChain&lt;`ArithError(string)&gt;&gt;,
   '_2069: Number,
   '_2067: Number,
   '_2071: Number&gt;
('_2067, '_2069) -&gt; '_2071 throws '_2073
</code></pre>
<p>Here we can see that <code>'_2067</code>, <code>'_2069</code>, and <code>'_2071</code> represent the two
arguments and the return type of the function. They are all unbound, meaning
that when the function is used they can have any type. They are also all
constrained to <code>Number</code>, and this will be enforced when the function is called,
it's arguments must be numbers and it will return a number. We learned this
because internally the function uses <code>+</code>, which operates on numbers, this
constraint was then propagated to the otherwise free variables representing the
args and the return type.</p>
<p>So in plain English this says that the arguments to the function can by any type
as long as it is a number, and the function will return some type which is a
number. None of the three numbers need to be the same type of number.</p>
<p>Finally lets address <code>throws '_2073</code>. This states that the function may throw an
error, and if it does it's type will be <code>'_2073</code>, which in this case is
constrained to be</p>
<p><code>Error&lt;ErrChain&lt;`ArithError(string)&gt;&gt;</code>.</p>
<p>This is what happens in the case of overflow, underflow, and other arithmetic
errors. The <code>throws</code> clause of the type is used by the <code>try catch(e) =&gt; ...</code>
expression to compute the type of <code>e</code>, which is just the union of all the throws
types within the <code>try catch</code>.</p>
<p>We can indeed call <code>f</code> with different number types, and it works just fine,</p>
<pre><code class="language-graphix">〉f(1.0, 1)
-: Number
2
</code></pre>
<p>The type we get back really depends on the values we pass. For example,</p>
<pre><code class="language-graphix">〉f(1.1212, 1)
-: Number
2.1212
</code></pre>
<p>Wherever we use <code>f</code> the compiler will force us to handle every possible case in
the <code>Number</code> type</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../functions/late_binding.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../functions/recursion.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../functions/late_binding.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../functions/recursion.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/graphix-highlight.js"></script>



    </div>
    </body>
</html>
